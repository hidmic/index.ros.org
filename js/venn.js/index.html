<h1 id="venn-js">venn.js</h1>

<p>A javascript library for laying out area proportional venn and euler diagrams.</p>

<p>Details of how this library works can be found on the <a href="http://www.benfrederickson.com/2013/05/09/venn-diagrams-with-d3.js.html">blog
post</a>
I wrote about this. There are also more examples on that page.</p>

<h4 id="usage">Usage</h4>

<p>This library depends on <a href="http://d3js.org/">d3.js</a> to display the venn
diagrams.</p>

<h5 id="simple-layout">Simple layout</h5>

<p>To lay out a simple diagram, just define the sets and their sizes along with the sizes 
of all the set intersection. Calling &#39;venn.venn&#39; will position the sets such
that the areas of each region are proportional to the sizes, and
&#39;venn.drawD3Diagram&#39; will display this diagram:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// define sets and set set intersections</span>
<span class="kd">var</span> <span class="nx">sets</span> <span class="o">=</span> <span class="p">[{</span><span class="na">label</span><span class="p">:</span> <span class="s2">"A"</span><span class="p">,</span> <span class="na">size</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span> <span class="p">{</span><span class="na">label</span><span class="p">:</span> <span class="s2">"B"</span><span class="p">,</span> <span class="na">size</span><span class="p">:</span> <span class="mi">10</span><span class="p">}],</span>
    <span class="nx">overlaps</span> <span class="o">=</span> <span class="p">[{</span><span class="na">sets</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="na">size</span><span class="p">:</span> <span class="mi">2</span><span class="p">}];</span>

<span class="c1">// get positions for each set</span>
<span class="nx">sets</span> <span class="o">=</span> <span class="nx">venn</span><span class="p">.</span><span class="nx">venn</span><span class="p">(</span><span class="nx">sets</span><span class="p">,</span> <span class="nx">overlaps</span><span class="p">);</span>

<span class="c1">// draw the diagram in the 'simple_example' div</span>
<span class="nx">venn</span><span class="p">.</span><span class="nx">drawD3Diagram</span><span class="p">(</span><span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">".simple_example"</span><span class="p">),</span> <span class="nx">sets</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">300</span><span class="p">);</span>
</code></pre></div>
<p><a href="http://benfred.github.io/venn.js/examples/simple.html">View this example </a></p>

<h5 id="changing-the-style">Changing the Style</h5>

<p>To change the style of the venn diagram, use D3 to set attributes on the &#39;text&#39; and &#39;circle&#39; objects that are returned from the drawD3Diagram call:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">diagram</span> <span class="o">=</span> <span class="nx">venn</span><span class="p">.</span><span class="nx">drawD3Diagram</span><span class="p">(</span><span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">"#rings"</span><span class="p">),</span>
                                 <span class="nx">venn</span><span class="p">.</span><span class="nx">venn</span><span class="p">(</span><span class="nx">sets</span><span class="p">,</span> <span class="nx">overlaps</span><span class="p">),</span> 
                                 <span class="mi">500</span><span class="p">,</span> <span class="mi">500</span><span class="p">);</span>

<span class="c1">// change the colours, add a thick border, remove fill</span>
<span class="kd">var</span> <span class="nx">colours</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'black'</span><span class="p">,</span> <span class="s1">'red'</span><span class="p">,</span> <span class="s1">'blue'</span><span class="p">,</span> <span class="s1">'green'</span><span class="p">]</span>
<span class="nx">diagram</span><span class="p">.</span><span class="nx">circles</span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"fill-opacity"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
               <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"stroke-width"</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
               <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"stroke-opacity"</span><span class="p">,</span> <span class="p">.</span><span class="mi">5</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"stroke"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">colours</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span> <span class="p">});</span>

<span class="c1">// make the font big and light</span>
<span class="nx">diagram</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"fill"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">colours</span><span class="p">[</span><span class="nx">i</span><span class="p">]})</span>
            <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"font-size"</span><span class="p">,</span> <span class="s2">"24px"</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"font-weight"</span><span class="p">,</span> <span class="s2">"100"</span><span class="p">);</span>
</code></pre></div>
<p><a href="http://benfred.github.io/venn.js/examples/styled.html">View this example, along with other possible styles</a></p>

<h5 id="dynamic-layout">Dynamic layout</h5>

<p>To have a layout that reacts to a change in input, you just need to recompute the areas and call updateD3Diagram to do the transition:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// draw the initial set</span>
<span class="kd">var</span> <span class="nx">sets</span> <span class="o">=</span> <span class="nx">venn</span><span class="p">.</span><span class="nx">venn</span><span class="p">(</span><span class="nx">getSets</span><span class="p">(),</span> <span class="nx">getSetIntersections</span><span class="p">());</span>
<span class="kd">var</span> <span class="nx">diagram</span> <span class="o">=</span> <span class="nx">venn</span><span class="p">.</span><span class="nx">drawD3Diagram</span><span class="p">(</span><span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">".dynamic"</span><span class="p">),</span> <span class="nx">sets</span><span class="p">,</span> <span class="nx">w</span><span class="p">,</span> <span class="nx">h</span><span class="p">);</span>

<span class="c1">// redraw the sets on any change in input</span>
<span class="nx">d3</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">"input"</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">"change"</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">sets</span> <span class="o">=</span> <span class="nx">venn</span><span class="p">.</span><span class="nx">venn</span><span class="p">(</span><span class="nx">getSets</span><span class="p">(),</span> <span class="nx">getSetIntersections</span><span class="p">());</span>
    <span class="nx">venn</span><span class="p">.</span><span class="nx">updateD3Diagram</span><span class="p">(</span><span class="nx">diagram</span><span class="p">,</span> <span class="nx">sets</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<p><a href="http://benfred.github.io/venn.js/examples/dynamic.html">View this example</a></p>

<h5 id="making-the-diagram-interactive">Making the diagram interactive</h5>

<p>Making the diagram interactive is basically the same idea as changing the style: just add event listeners to the returned elements. To change the text size and circle colours on mouseover:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">diagram</span><span class="p">.</span><span class="nx">nodes</span>
    <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"mouseover"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">transition</span><span class="p">();</span>
        <span class="nx">node</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">"circle"</span><span class="p">).</span><span class="nx">style</span><span class="p">(</span><span class="s2">"fill-opacity"</span><span class="p">,</span> <span class="p">.</span><span class="mi">1</span><span class="p">);</span>
        <span class="nx">node</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">"text"</span><span class="p">).</span><span class="nx">style</span><span class="p">(</span><span class="s2">"font-size"</span><span class="p">,</span> <span class="s2">"36px"</span><span class="p">);</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"mouseout"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">transition</span><span class="p">();</span>
        <span class="nx">node</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">"circle"</span><span class="p">).</span><span class="nx">style</span><span class="p">(</span><span class="s2">"fill-opacity"</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="nx">node</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">"text"</span><span class="p">).</span><span class="nx">style</span><span class="p">(</span><span class="s2">"font-size"</span><span class="p">,</span> <span class="s2">"24px"</span><span class="p">);</span>
    <span class="p">});</span>
</code></pre></div>
<p><a href="http://benfred.github.io/venn.js/examples/interactive.html">View this example</a></p>

<h5 id="adding-tooltips-to-the-intersection-areas">Adding tooltips to the intersection areas</h5>

<p>The intersection areas aren&#39;t drawn by default, but there is some code
included here to draw a svg path element around the intersection areas. To add
a tooltip to the intersection area, use the &#39;intersectionAreaPath&#39; method to
define the area, and then add appropiate events to handle the tooltip:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">diagram</span><span class="p">.</span><span class="nx">svg</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">"g"</span><span class="p">).</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">"path"</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">overlaps</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"path"</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"d"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span> 
        <span class="k">return</span> <span class="nx">venn</span><span class="p">.</span><span class="nx">intersectionAreaPath</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">sets</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">j</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">sets</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span> <span class="p">}));</span> 
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"fill-opacity"</span><span class="p">,</span><span class="s2">"0"</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"fill"</span><span class="p">,</span> <span class="s2">"black"</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"stroke-opacity"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"stroke"</span><span class="p">,</span> <span class="s2">"white"</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"stroke-width"</span><span class="p">,</span> <span class="s2">"2"</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"mouseover"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">transition</span><span class="p">()</span>
            <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"fill-opacity"</span><span class="p">,</span> <span class="p">.</span><span class="mi">1</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"stroke-opacity"</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="nx">tooltip</span><span class="p">.</span><span class="nx">transition</span><span class="p">().</span><span class="nx">style</span><span class="p">(</span><span class="s2">"opacity"</span><span class="p">,</span> <span class="p">.</span><span class="mi">9</span><span class="p">);</span>
        <span class="nx">tooltip</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">size</span> <span class="o">+</span> <span class="s2">" users"</span><span class="p">);</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"mouseout"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">transition</span><span class="p">()</span>
            <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"fill-opacity"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"stroke-opacity"</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="nx">tooltip</span><span class="p">.</span><span class="nx">transition</span><span class="p">().</span><span class="nx">style</span><span class="p">(</span><span class="s2">"opacity"</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"mousemove"</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">tooltip</span><span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"left"</span><span class="p">,</span> <span class="p">(</span><span class="nx">d3</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">pageX</span><span class="p">)</span> <span class="o">+</span> <span class="s2">"px"</span><span class="p">)</span>
               <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">"top"</span><span class="p">,</span> <span class="p">(</span><span class="nx">d3</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">pageY</span> <span class="o">-</span> <span class="mi">28</span><span class="p">)</span> <span class="o">+</span> <span class="s2">"px"</span><span class="p">);</span>
    <span class="p">})</span>
</code></pre></div>
<p><a href="http://benfred.github.io/venn.js/examples/intersection_tooltip.html">View this example</a></p>

<h5 id="mds-layout">MDS Layout</h5>

<p>In most cases the greedy initial layout does a good job of positioning the
sets, but there are cases where it breaks down. One case is detailed in <a href="http://www.benfrederickson.com/2013/05/16/multidimensional-scaling.html">this
blog post</a>,
and it can be better laid out using <a href="https://en.wikipedia.org/wiki/Multidimensional_scaling">multidimensional
scaling</a> to generate
the initial layout.</p>

<p>To enable this just include the <a href="http://github.com/benfred/mds.js">mds.js</a>
and <a href="http://numericjs.com">numeric.js</a> libraries first, and then generate the venn positions by calling:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">sets</span> <span class="o">=</span> <span class="nx">venn</span><span class="p">.</span><span class="nx">venn</span><span class="p">(</span><span class="nx">sets</span><span class="p">,</span> <span class="nx">overlaps</span><span class="p">,</span> <span class="p">{</span><span class="na">layoutFunction</span><span class="p">:</span> <span class="nx">venn</span><span class="p">.</span><span class="nx">classicMDSLayout</span><span class="p">});</span>
</code></pre></div>
<p><a href="http://benfred.github.io/venn.js/examples/mds.html">View this example</a></p>

<p>Released under the MIT License.</p>
