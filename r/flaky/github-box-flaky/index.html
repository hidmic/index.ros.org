<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>ROS Index</title>
    <meta name="description" content="a community-maintained index of robotics software
">

    <link rel="canonical" href="https://ros-infrastructure.github.io/index.ros.org//r/flaky/github-box-flaky/">
    <link rel="stylesheet" type="text/css" href="/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/css/main.css">
    

    <script type="text/javascript" src=/js/jquery.js></script>
    <script src=/bootstrap/js/bootstrap.min.js type="text/javascript"></script>
    <script src=/js/jquery-cookie-1.4.1/jquery.cookie.js type="text/javascript"></script>

    <script type="text/javascript" src=/js/ga.js async></script>
    <script type="text/javascript" src=/js/toc.js></script>

    <script src=/js/distro_switch.js></script>
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">
    <div class="container-fluid" style="margin-bottom: 10px">
      <div class="row">


        <div class="col-sm-12 col-md-9" style="margin-top: 8px">
          <div class="row">
            <!-- title -->
            <div class="col-xs-12 col-sm-3 col-md-3" style="white-space:nowrap;">
              <a class="site-title" href="/">ROS Index</a> <sup><a href="https://github.com/ros-infrastructure/rosindex/issues/new" style="vertical-align:super;" class="label label-warning" target="_blank">BETA</a></sup>
            </div>

            <!-- main links -->
            <div class="col-xs-12 col-sm-9 col-md-9 text-right">
              <ul class="list-inline" style="margin-bottom:0px;">
                <li><a class="btn btn-link" href="/about">About</a></li>

                <li class="dropdown">
                  <button id="dLabel" class="btn btn-link" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Index <span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
                    <li><a href="/packages/page/1/time/">Package List</a></li>
                    <li><a href="/repos/page/1/time/">Repository List</a></li>

                    <li class="hidden" class="divider"></li>


                    <li class="hidden"><a href="/srvs/">Nodes</a></li>
                    <li class="hidden"><a href="/msgs/">Messages</a></li>
                    <li class="hidden"><a href="/srvs/">Services</a></li>
                    <li class="hidden"><a href="/srvs/">Plugins</a></li>

                    <li class="divider"></li>

                    <li><a href="/deps/">System Dependencies</a></li>
                  </ul>
                </li>

                <li class="dropdown disabled">
                  <button id="dLabel" class="btn btn-link" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Doc <span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
                    
                    <li>
                      <a href="/doc/ros2">
                        ROS2 Overview
                      </a>
                    </li>
                    
                    <li class="hidden" class="divider"></li>

                    <li class="hidden"><a href="/doc/tutorials">Tutorials</a></li>
                    <li class="hidden"><a href="/doc/readmes">Readmes</a></li>
                    <li class="hidden"><a href="/doc/apis">APIs</a></li>
                  </ul>
                </li>

                <li><a class="btn btn-link" href="/contribute">Contribute</a></li>
                <li><a class="btn btn-link" href="/stats">Stats</a></li>
              </ul>

            </div>
          </div>
        </div>

        <!-- searchbox -->
        <div class="col-sm-12 col-md-3" style="margin-top: 12px">
          <form id="top-searchbox" action="/search/" role="form" method="get">
            <div class="input-group input-group-sm">
              <input type="text" class="form-control" name="q" placeholder="Search ROS Packages">
              <span class="input-group-btn">
                <button class="btn btn-default btn-sm" title="Search ROS Packages" type="submit"><span class="glyphicon glyphicon-search"></span></button>
              </span>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!--
    <a class="site-title" href="/">ROS Index</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        <a class="page-link" href="/packages">Packages</a>
        <a class="page-link" href="/repos">Repositories</a>
        <a class="page-link" href="/search">Search</a>
      </div>
    </nav>
    -->

  </div>
  <script type="text/javascript">
    $('#top-searchbox').submit(function() {
        return $('#top-searchbox input:text').filter(function() {
          return $(this).val() == "";
        }).length == 0;
    });
  </script>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="container-fluid" style="margin-top:20px">
  <div class="container-fluid">
    <div class="row">
      <ol class="breadcrumb">
        <li><a href="/">Home</a></li>
        <li><a href="/repos">Repos</a></li>
        <li class="active">flaky</li>
        <!--<li class="active">flaky</li>-->
      </ol>
    </div>
    <div class="row">
      

<div id="distro-switch" class="btn-group btn-group-justified" data-toggle="buttons">
  
    <label id="melodic-option" class="distro-button btn btn-xs btn-default" href="#melodic" data="melodic">
      <input type="radio" name="options" id="melodic-radio" autocomplete="off"> melodic
    </label>
  
    <label id="lunar-option" class="distro-button btn btn-xs btn-default" href="#lunar" data="lunar">
      <input type="radio" name="options" id="lunar-radio" autocomplete="off"> lunar
    </label>
  
    <label id="kinetic-option" class="distro-button btn btn-xs btn-default" href="#kinetic" data="kinetic">
      <input type="radio" name="options" id="kinetic-radio" autocomplete="off"> kinetic
    </label>
  
    <label id="indigo-option" class="distro-button btn btn-xs btn-primary" href="#indigo" data="indigo">
      <input type="radio" name="options" id="indigo-radio" autocomplete="off"> indigo
    </label>
  
    <label id="bouncy-option" class="distro-button btn btn-xs btn-default" href="#bouncy" data="bouncy">
      <input type="radio" name="options" id="bouncy-radio" autocomplete="off"> bouncy
    </label>
  
    <label id="ardent-option" class="distro-button btn btn-xs btn-default" href="#ardent" data="ardent">
      <input type="radio" name="options" id="ardent-radio" autocomplete="off"> ardent
    </label>
  

  <!-- Older distros -->
  <div class="btn-group dropdown">
    <label type="button" class="btn btn-xs dropdown-toggle btn-primary" data-toggle="dropdown" id="older-distro-button">
        <input type="radio" name="options" autocomplete="off">
      <span id="older-label">Older</span>
      <span class="caret"></span>
    </label>
    <ul class="dropdown-menu" role="menu">
      
        <li data="jade" id="jade-option" class=" older-distro-option"  href="#jade">
          <a href="#jade" data="jade" id="jade-button">jade</a>
        </li>
      
        <li data="hydro" id="hydro-option" class="disabled older-distro-option"  href="#hydro">
          <a href="#hydro" data="hydro" id="hydro-button">hydro</a>
        </li>
      
    </ul>
  </div>
</div>

    </div>
    <div class="row">
      &nbsp;
    </div>
    <div class="row">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/flaky">flaky</a> <small>repository</small></h3>
        
      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 50px">
          <a type="button" class="btn btn-xs btn-default" data-toggle="tooltip" data-placement="left" title="View Instances" 
            href="/repos/flaky"><span class="glyphicon glyphicon-th"></span></a>
        </div>
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-box-flaky
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-box-flaky" role="menuitem" tabindex="-1" href="/r/flaky/github-box-flaky" data="github-box-flaky">
                    <span class="glyphicon glyphicon-star"></span>
                    github-box-flaky
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

    </div>
  </div>
</div>


  <div class="distro distro-melodic">
    <div class="container-fluid">
      
        <div class="alert alert-warning" role="alert">No version for distro <strong>melodic</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-lunar">
    <div class="container-fluid">
      
        <div class="alert alert-warning" role="alert">No version for distro <strong>lunar</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-kinetic">
    <div class="container-fluid">
      
        <div class="alert alert-warning" role="alert">No version for distro <strong>kinetic</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-indigo">
    <div class="container-fluid">
      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            

  <table class="table table-condensed">
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/box/flaky.git">https://github.com/box/flaky.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">v3.1.0</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2016-02-11
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-primary">
          
          MAINTAINED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/flaky/github-box-flaky">flaky</a></td>
                    <td>3.1.0</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body><div class="rendered-markdown">
<h1 id="flaky">flaky</h1>

<p><a href="http://opensource.box.com/badges"><img src="http://opensource.box.com/badges/active.svg" alt="image"></a></p>

<p><a href="https://travis-ci.org/box/flaky"><img src="https://travis-ci.org/box/flaky.png?branch=master" alt="image"></a></p>

<p><a href="https://pypi.python.org/pypi/flaky"><img src="https://img.shields.io/pypi/v/flaky.svg" alt="image"></a></p>

<p><a href="https://pypi.python.org/pypi/flaky"><img src="https://img.shields.io/pypi/dm/flaky.svg" alt="image"></a></p>

<h2 id="about">About</h2>

<p>Flaky is a plugin for nose or py.test that automatically reruns flaky
tests.</p>

<p>Ideally, tests reliably pass or fail, but sometimes test fixtures must
rely on components that aren't 100% reliable. With flaky, instead of
removing those tests or marking them to @skip, they can be automatically
retried.</p>

<p>For more information about flaky, see <a href="http://opensource.box.com/flaky/">this
presentation</a>.</p>

<h3 id="marking-tests-flaky">Marking tests flaky</h3>

<p>To mark a test as flaky, simply import flaky and decorate the test with
@flaky:</p>
<div class="highlight"><pre><code class="language-.sourceCode .python" data-lang=".sourceCode .python">from flaky import flaky

</code></pre></div>
<div class="highlight"><pre><code class="language-.sourceCode .python" data-lang=".sourceCode .python">@flaky
def test_something_that_usually_passes(self):
    value_to_double = 21
    result = get_result_from_flaky_doubler(value_to_double)
    self.assertEqual(result, value_to_double * 2, 'Result doubled incorrectly.')

</code></pre></div>
<p>By default, flaky will retry a failing test once, but that behavior can
be overridden by passing values to the flaky decorator. It accepts two
parameters: max_runs, and min_passes; flaky will run tests up to
max_runs times, until it has succeeded min_passes times. Once a test
passes min_passes times, it's considered a success; once it has been
run max_runs times without passing min_passes times, it's considered a
failure.</p>
<div class="highlight"><pre><code class="language-.sourceCode .python" data-lang=".sourceCode .python">@flaky(max_runs=3, min_passes=2)
def test_something_that_usually_passes(self):
    """This test must pass twice, and it can be run up to three times."""
    value_to_double = 21
    result = get_result_from_flaky_doubler(value_to_double)
    self.assertEqual(result, value_to_double * 2, 'Result doubled incorrectly.')

</code></pre></div>
<h3 id="marking-a-class-flaky">Marking a class flaky</h3>

<p>In addition to marking a single test flaky, entire test cases can be
marked flaky:</p>
<div class="highlight"><pre><code class="language-.sourceCode .python" data-lang=".sourceCode .python">@flaky
class TestMultipliers(TestCase):
    def test_flaky_doubler(self):
        value_to_double = 21
        result = get_result_from_flaky_doubler(value_to_double)
        self.assertEqual(result, value_to_double * 2, 'Result doubled incorrectly.')

    @flaky(max_runs=3)
    def test_flaky_tripler(self):
        value_to_triple = 14
        result = get_result_from_flaky_tripler(value_to_triple)
        self.assertEqual(result, value_to_triple * 3, 'Result tripled incorrectly.')

</code></pre></div>
<p>The @flaky class decorator will mark test_flaky_doubler as flaky, but
it won't override the 3 max_runs for test_flaky_tripler (from the
decorator on that test method).</p>

<h3 id="dont-rerun-certain-types-of-failures">Don't rerun certain types of failures</h3>

<p>Depending on your tests, some failures are obviously not due to
flakiness. Instead of rerunning after those failures, you can specify a
filter function that can tell flaky to fail the test right away.</p>
<div class="highlight"><pre><code class="language-.sourceCode .python" data-lang=".sourceCode .python">def is_not_crash(err, *args):
    return not issubclass(err[0], ProductCrashedError)

@flaky
def test_something():
    raise ProductCrashedError

@flaky(rerun_filter=is_not_crash)
def test_something_else():
    raise ProductCrashedError

</code></pre></div>
<p>Flaky will run test_something twice, but will only run
test_something_else once.</p>

<p>It can also be used to incur a delay between test retries:</p>
<div class="highlight"><pre><code class="language-.sourceCode .python" data-lang=".sourceCode .python">import time

def delay_rerun(*args):
    time.sleep(1)
    return True

@flaky(rerun_filter=delay_rerun)
def test_something_else():
    ...

</code></pre></div>
<h3 id="activating-the-plugin">Activating the plugin</h3>

<p>Like any nose plugin, flaky can be activated via the command line:</p>
<div class="highlight"><pre><code class="language-.sourceCode .console" data-lang=".sourceCode .console">nosetests --with-flaky

</code></pre></div>
<p>With py.test, flaky will automatically run. It can, however be disabled
via the command line:</p>
<div class="highlight"><pre><code class="language-.sourceCode .console" data-lang=".sourceCode .console">py.test -p no:flaky

</code></pre></div>
<h3 id="command-line-arguments">Command line arguments</h3>

<h4 id="no-flaky-report">No Flaky Report</h4>

<p>Pass <code>--no-flaky-report</code> to suppress the report at the end of the run
detailing flaky test results.</p>

<h4 id="shorter-flaky-report">Shorter Flaky Report</h4>

<p>Pass <code>--no-success-flaky-report</code> to suppress information about
successful flaky tests.</p>

<h4 id="force-flaky">Force Flaky</h4>

<p>Pass <code>--force-flaky</code> to treat all tests as flaky.</p>

<p>Pass <code>--max-runs=MAX_RUNS</code> and/or <code>--min-passes=MIN_PASSES</code> to control
the behavior of flaky if <code>--force-flaky</code> is specified. Flaky decorators
on individual tests will override these defaults.</p>

<p><em>Additional usage examples are in the code - see test/test_example.py</em></p>

<h2 id="installation">Installation</h2>

<p>To install, simply:</p>
<div class="highlight"><pre><code class="language-.sourceCode .console" data-lang=".sourceCode .console">pip install flaky

</code></pre></div>
<h2 id="compatibility">Compatibility</h2>

<p>Flaky is tested with the following test runners and options:</p>

<ul>
<li>  Nosetests. Doctests cannot be marked flaky.</li>
<li>  Py.test. Works with pytest-xdist but not with the --boxed option.
Doctests cannot be marked flaky.</li>
</ul>

<h2 id="contributing">Contributing</h2>

<p>See
<a href="https://github.com/box/flaky/blob/master/CONTRIBUTING.rst">CONTRIBUTING.rst</a>.</p>

<h3 id="setup">Setup</h3>

<p>Create a virtual environment and install packages -</p>
<div class="highlight"><pre><code class="language-.sourceCode .console" data-lang=".sourceCode .console">mkvirtualenv flaky
pip install -r requirements-dev.txt

</code></pre></div>
<h3 id="testing">Testing</h3>

<p>Run all tests using -</p>
<div class="highlight"><pre><code class="language-.sourceCode .console" data-lang=".sourceCode .console">tox

</code></pre></div>
<p>The tox tests include code style checks via pep8 and pylint.</p>

<h2 id="copyright-and-license">Copyright and License</h2>
<div class="highlight"><pre><code class="language-" data-lang="">Copyright 2015 Box, Inc. All rights reserved.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
</code></pre></div>
</div></body></html>

            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-bouncy">
    <div class="container-fluid">
      
        <div class="alert alert-warning" role="alert">No version for distro <strong>bouncy</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-ardent">
    <div class="container-fluid">
      
        <div class="alert alert-warning" role="alert">No version for distro <strong>ardent</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-jade">
    <div class="container-fluid">
      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            

  <table class="table table-condensed">
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/box/flaky.git">https://github.com/box/flaky.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">v3.1.0</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2016-02-11
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-primary">
          
          MAINTAINED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/flaky/github-box-flaky">flaky</a></td>
                    <td>3.1.0</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body><div class="rendered-markdown">
<h1 id="flaky">flaky</h1>

<p><a href="http://opensource.box.com/badges"><img src="http://opensource.box.com/badges/active.svg" alt="image"></a></p>

<p><a href="https://travis-ci.org/box/flaky"><img src="https://travis-ci.org/box/flaky.png?branch=master" alt="image"></a></p>

<p><a href="https://pypi.python.org/pypi/flaky"><img src="https://img.shields.io/pypi/v/flaky.svg" alt="image"></a></p>

<p><a href="https://pypi.python.org/pypi/flaky"><img src="https://img.shields.io/pypi/dm/flaky.svg" alt="image"></a></p>

<h2 id="about">About</h2>

<p>Flaky is a plugin for nose or py.test that automatically reruns flaky
tests.</p>

<p>Ideally, tests reliably pass or fail, but sometimes test fixtures must
rely on components that aren't 100% reliable. With flaky, instead of
removing those tests or marking them to @skip, they can be automatically
retried.</p>

<p>For more information about flaky, see <a href="http://opensource.box.com/flaky/">this
presentation</a>.</p>

<h3 id="marking-tests-flaky">Marking tests flaky</h3>

<p>To mark a test as flaky, simply import flaky and decorate the test with
@flaky:</p>
<div class="highlight"><pre><code class="language-.sourceCode .python" data-lang=".sourceCode .python">from flaky import flaky

</code></pre></div>
<div class="highlight"><pre><code class="language-.sourceCode .python" data-lang=".sourceCode .python">@flaky
def test_something_that_usually_passes(self):
    value_to_double = 21
    result = get_result_from_flaky_doubler(value_to_double)
    self.assertEqual(result, value_to_double * 2, 'Result doubled incorrectly.')

</code></pre></div>
<p>By default, flaky will retry a failing test once, but that behavior can
be overridden by passing values to the flaky decorator. It accepts two
parameters: max_runs, and min_passes; flaky will run tests up to
max_runs times, until it has succeeded min_passes times. Once a test
passes min_passes times, it's considered a success; once it has been
run max_runs times without passing min_passes times, it's considered a
failure.</p>
<div class="highlight"><pre><code class="language-.sourceCode .python" data-lang=".sourceCode .python">@flaky(max_runs=3, min_passes=2)
def test_something_that_usually_passes(self):
    """This test must pass twice, and it can be run up to three times."""
    value_to_double = 21
    result = get_result_from_flaky_doubler(value_to_double)
    self.assertEqual(result, value_to_double * 2, 'Result doubled incorrectly.')

</code></pre></div>
<h3 id="marking-a-class-flaky">Marking a class flaky</h3>

<p>In addition to marking a single test flaky, entire test cases can be
marked flaky:</p>
<div class="highlight"><pre><code class="language-.sourceCode .python" data-lang=".sourceCode .python">@flaky
class TestMultipliers(TestCase):
    def test_flaky_doubler(self):
        value_to_double = 21
        result = get_result_from_flaky_doubler(value_to_double)
        self.assertEqual(result, value_to_double * 2, 'Result doubled incorrectly.')

    @flaky(max_runs=3)
    def test_flaky_tripler(self):
        value_to_triple = 14
        result = get_result_from_flaky_tripler(value_to_triple)
        self.assertEqual(result, value_to_triple * 3, 'Result tripled incorrectly.')

</code></pre></div>
<p>The @flaky class decorator will mark test_flaky_doubler as flaky, but
it won't override the 3 max_runs for test_flaky_tripler (from the
decorator on that test method).</p>

<h3 id="dont-rerun-certain-types-of-failures">Don't rerun certain types of failures</h3>

<p>Depending on your tests, some failures are obviously not due to
flakiness. Instead of rerunning after those failures, you can specify a
filter function that can tell flaky to fail the test right away.</p>
<div class="highlight"><pre><code class="language-.sourceCode .python" data-lang=".sourceCode .python">def is_not_crash(err, *args):
    return not issubclass(err[0], ProductCrashedError)

@flaky
def test_something():
    raise ProductCrashedError

@flaky(rerun_filter=is_not_crash)
def test_something_else():
    raise ProductCrashedError

</code></pre></div>
<p>Flaky will run test_something twice, but will only run
test_something_else once.</p>

<p>It can also be used to incur a delay between test retries:</p>
<div class="highlight"><pre><code class="language-.sourceCode .python" data-lang=".sourceCode .python">import time

def delay_rerun(*args):
    time.sleep(1)
    return True

@flaky(rerun_filter=delay_rerun)
def test_something_else():
    ...

</code></pre></div>
<h3 id="activating-the-plugin">Activating the plugin</h3>

<p>Like any nose plugin, flaky can be activated via the command line:</p>
<div class="highlight"><pre><code class="language-.sourceCode .console" data-lang=".sourceCode .console">nosetests --with-flaky

</code></pre></div>
<p>With py.test, flaky will automatically run. It can, however be disabled
via the command line:</p>
<div class="highlight"><pre><code class="language-.sourceCode .console" data-lang=".sourceCode .console">py.test -p no:flaky

</code></pre></div>
<h3 id="command-line-arguments">Command line arguments</h3>

<h4 id="no-flaky-report">No Flaky Report</h4>

<p>Pass <code>--no-flaky-report</code> to suppress the report at the end of the run
detailing flaky test results.</p>

<h4 id="shorter-flaky-report">Shorter Flaky Report</h4>

<p>Pass <code>--no-success-flaky-report</code> to suppress information about
successful flaky tests.</p>

<h4 id="force-flaky">Force Flaky</h4>

<p>Pass <code>--force-flaky</code> to treat all tests as flaky.</p>

<p>Pass <code>--max-runs=MAX_RUNS</code> and/or <code>--min-passes=MIN_PASSES</code> to control
the behavior of flaky if <code>--force-flaky</code> is specified. Flaky decorators
on individual tests will override these defaults.</p>

<p><em>Additional usage examples are in the code - see test/test_example.py</em></p>

<h2 id="installation">Installation</h2>

<p>To install, simply:</p>
<div class="highlight"><pre><code class="language-.sourceCode .console" data-lang=".sourceCode .console">pip install flaky

</code></pre></div>
<h2 id="compatibility">Compatibility</h2>

<p>Flaky is tested with the following test runners and options:</p>

<ul>
<li>  Nosetests. Doctests cannot be marked flaky.</li>
<li>  Py.test. Works with pytest-xdist but not with the --boxed option.
Doctests cannot be marked flaky.</li>
</ul>

<h2 id="contributing">Contributing</h2>

<p>See
<a href="https://github.com/box/flaky/blob/master/CONTRIBUTING.rst">CONTRIBUTING.rst</a>.</p>

<h3 id="setup">Setup</h3>

<p>Create a virtual environment and install packages -</p>
<div class="highlight"><pre><code class="language-.sourceCode .console" data-lang=".sourceCode .console">mkvirtualenv flaky
pip install -r requirements-dev.txt

</code></pre></div>
<h3 id="testing">Testing</h3>

<p>Run all tests using -</p>
<div class="highlight"><pre><code class="language-.sourceCode .console" data-lang=".sourceCode .console">tox

</code></pre></div>
<p>The tox tests include code style checks via pep8 and pylint.</p>

<h2 id="copyright-and-license">Copyright and License</h2>
<div class="highlight"><pre><code class="language-" data-lang="">Copyright 2015 Box, Inc. All rights reserved.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
</code></pre></div>
</div></body></html>

            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-hydro">
    <div class="container-fluid">
      
        <div class="alert alert-warning" role="alert">No version for distro <strong>hydro</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>



      </div>
    </div>

    <footer class="site-footer">
  <div class="wrapper">
    <div class="container-fluid">
      <div class="row">
        <div class="col-sm-4 col-md-4">
          
            <a href="https://github.com/ros-infrastructure" title="Find rosindex in Github">
            <span class="icon  icon--github">
              <svg viewBox="0 0 16 16">
                <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
              </svg>
            </span>

            <span class="username">ros-infrastructure</span>
          </a>
          |
          <em>generated on 2018-10-26</em>
        
        </div>
        <div class="col-sm-8 col-md-8 text-right">
          <p class="text">a community-maintained index of robotics software
 | <a href="/privacy.txt">privacy</a></p>
        </div>
      </div>
    </div>
  </div>

</footer>


  </body>

</html>
